<ui:composition xmlns="http://www.w3.org/1999/xhtml"
       			xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:b="http://xmlns.jcp.org/jsf/composite/bunsysComponents"
                template="/WEB-INF/templates/template.xhtml">
    <ui:param name="idForm" value="frmNotaCredito"/>
    <ui:param name="controller" value="#{notaCreditoController}"/>
    <ui:define name="contentBody">
		<p:panel header="#{msg['lbl_notas_credito']}">
			<p:fieldset legend="#{msg['lbl_datos_cabecera_nc']}">
				 <h:panelGroup layout="block" id="pnlDatosRef" >
					 <h:panelGrid columns="4">
						<p:fieldset legend="Comprobante"  style="display:block;width: 400px; height: 60px; ">
							<h:panelGrid columns="3">
								<p:outputLabel for="txtNumeroNotaCredito" value="#{msg['lbl_numero_nc']}:" style="display:block;width: 100px;"/>
								<h:panelGrid columns="3" style="border: collapse;" cellpadding="0" cellspacing="0">
									<p:inputText value="#{notaCreditoDatamanager.compania.codigoestablecimiento}" style="width: 50px;" disabled="true"/>
									<p:inputText value="#{notaCreditoDatamanager.compania.codigopuntoemision}" style="width: 50px;" disabled="true"/>
									<p:inputText id="txtNumeroNotaCredito" value="#{notaCreditoDatamanager.cabdevoluciones.pk.numerodevoluciones}" required="true" disabled="true">
										<pe:keyFilter mask="pint"/>
									</p:inputText>
								</h:panelGrid>
								<p:message for="txtNumeroNotaCredito"/>
							</h:panelGrid>
						</p:fieldset>
						<p:fieldset legend="Referencia" style="display:block;width: 450px; height: 60px; ">
							<h:panelGrid columns="4">
								<p:outputLabel for="txtNumeroFactura" value="#{msg['lbl_factura']}:" style="display:block;width: 100px; "/>
								<p:panelGrid>
									<p:inputText value="#{notaCreditoDatamanager.compania.codigoestablecimiento}" style="width: 50px;" disabled="true"/>
									<p:inputText value="#{notaCreditoDatamanager.compania.codigopuntoemision}" style="width: 50px;" disabled="true"/>
									<p:inputMask id="txtNumeroFactura" value="#{notaCreditoDatamanager.cabdevoluciones.numerofactura}" mask="999999999" required="true"/>
								</p:panelGrid>
								<p:message for="txtNumeroFactura"/>
								<p:commandButton icon="ui-icon-search"
									action="#{notaCreditoController.busquedaFactura}" 
									process="@this txtNumeroFactura" 
									update="pnlDatosCabecera pnlDetallesNC pnlTotales"/>
							</h:panelGrid>
						</p:fieldset>
					</h:panelGrid>
				</h:panelGroup>
				<br/>
				<h:panelGroup layout="block" id="pnlDatosCabecera">
					<p:panelGrid columns="1" style="width: 100%;">
						<f:facet name="header">
							<h:outputText value="#{msg['lbl_datos_generales']}"/>
						</f:facet>
						<h:panelGroup layout="block">
							<h:panelGrid columns="3">	
								<p:outputLabel for="txtFechaDevolucion" value="#{msg.lbl_fecha}:" style="display:block;width: 150px;"/>
								<p:calendar id="txtFechaDevolucion" value="#{notaCreditoDatamanager.cabdevoluciones.fechadevolucion}" mask="true" pattern="#{msg.pattern_date}" required="true"/>
								<p:message for="txtFechaDevolucion"/>
							</h:panelGrid>
							<h:panelGrid columns="3">
								<p:outputLabel for="selEstado" value="#{msg['lbl_estado']}:" style="display:block;width: 150px;"/>
								<p:selectOneMenu id="selEstado" value="#{notaCreditoDatamanager.cabdevoluciones.estado}">
									<f:selectItem itemLabel="Seleccione" itemValue="#{null}"/>
									<f:selectItems value="#{notaCreditoDatamanager.catalogoEstadoColl}" var="estado" itemLabel="#{estado.descripcion}" itemValue="#{estado.pk.codigocatalogo}"/>
								</p:selectOneMenu>
								<p:message for="selEstado"/>
							</h:panelGrid>
							<h:panelGrid columns="3">
								<p:outputLabel for="txtObservacion" value="#{msg['lbl_obs']}:" style="display:block;width: 150px;"/>
								<p:inputTextarea id="txtObservacion" value="#{notaCreditoDatamanager.cabdevoluciones.observacion}" style="display:block;width: 700px;"/>
								<p:message for="txtObservacion"/>
							</h:panelGrid>
						</h:panelGroup>
					</p:panelGrid>
					<p:panelGrid columns="1" style="width: 100%;">
						<f:facet name="header">
							<h:outputText value="#{msg['lbl_datos_cliente']}" />
						</f:facet>
						<h:panelGrid columns="4" id="pnlCliente">
							<p:outputLabel for="txtIdentificacion" value="#{msg['lbl_identificacion']}:" style="display:block;width: 150px;"/>
							<p:inputText id="txtIdentificacion" value="#{notaCreditoDatamanager.cabdevoluciones.tfaccliente.tsyspersona.identificacion}" disabled="true">
								<pe:keyFilter mask="pint"/>
							</p:inputText>
							<p:message for="txtIdentificacion"/>
							<p:commandButton icon="ui-icon-extlink" oncomplete="PF('dlgClienteBusqueda').show();"/>
							
							<p:outputLabel for="txtNombrePersona" value="#{msg['lbl_nombres_razon_social']}:" style="display:block;width: 150px;"/>
							<p:inputText id="txtNombrePersona"
								disabled="true" 
								value="#{notaCreditoDatamanager.cabdevoluciones.tfaccliente.tsyspersona.nombres}" 
								onkeyup="bunsys.toUppercase(event, this)" 
								style="width: 450px;" />
							<p:message for="txtNombrePersona"/>
							
						</h:panelGrid>
					</p:panelGrid>
				</h:panelGroup>
			</p:fieldset>
			<p:fieldset legend="#{msg['lbl_datos_detalle_nc']}" id="pnlDetallesNC">
				<p:commandButton value="#{msg['btn_anadir']}" icon="ui-icon-plusthick"/>
				<p:dataTable value="#{notaCreditoDatamanager.detdevolucionesColl}" var="detDevolucion">
					<p:column headerText="#{msg['lbl_codigo']}">
						<h:outputText value="#{detDevolucion.tinvproducto.pk.codigoproductos}" />
					</p:column>
					<p:column headerText="#{msg['lbl_codigo_auxiliar']}">
						<h:outputText value="#{detDevolucion.tinvproducto.codigoauxiliar}" />
					</p:column>
					<p:column headerText="#{msg['lbl_unidad_venta']}">
						<h:outputText value="#{detDevolucion.tinvproducto.tadmunidadventa.descripcion}" />
					</p:column>
					<p:column headerText="#{msg['lbl_cantidad_item']}">
						<h:outputText value="#{detDevolucion.cantidad}" />
					</p:column>
					<p:column headerText="#{msg['lbl_precio']}">
						<h:outputText value="#{detDevolucion.tinvproducto.preciounitario}" />
					</p:column>
					<p:column headerText="#{msg['lbl_descripcion']}">
						<h:outputText value="#{detDevolucion.tinvproducto.nombre}" />
					</p:column>
					<p:column headerText="#{msg['lbl_iva']}">
						<h:outputText value="#{detDevolucion.tadmiva.descripcion}" />
					</p:column>
					<p:column headerText="#{msg['lbl_ice']}">
						<h:outputText value="#{detDevolucion.tadmice.descripcion}" />
					</p:column>
					<p:column headerText="#{msg['lbl_irbpnr']}">
						<h:outputText value="#{detDevolucion.tadmirbpnr.descripcion}" />
					</p:column>
					<p:column headerText="#{msg['lbl_total']}">
						<h:outputText value="#{detDevolucion.aditionalProperties['total']}" />
					</p:column>
				</p:dataTable>
			</p:fieldset>
			<p:fieldset legend="#{msg['lbl_totales']}" id="pnlTotales">
				<h:panelGrid columns="6">
					<p:outputLabel value="#{msg['lbl_subtotal_sin_impuestos']}:" style="display:block;width: 150px;"/>
					<h:outputText value="#{notaCreditoDatamanager.cabdevoluciones.subtotalneto}" style="display:block;width: 100px;"/>
					<p:outputLabel value="#{msg['lbl_subtotal12']}:"/>
					<h:outputText value="#{notaCreditoDatamanager.cabdevoluciones.subtotaliva}" style="display:block;width: 100px;"/>
					<p:outputLabel value="#{msg['lbl_subtotal0']}:" style="display:block;width: 150px;"/>
					<h:outputText value="#{notaCreditoDatamanager.cabdevoluciones.subtotalbase}" style="display:block;width: 100px;"/>
					<p:outputLabel value="#{msg['lbl_subtotal_noiva']}:"/>
					<h:outputText value="#{notaCreditoDatamanager.cabdevoluciones.subtotalnoiva}" style="display:block;width: 100px;"/>
					<p:outputLabel value="#{msg['lbl_subtotal_exiva']}:" style="display:block;width: 150px;"/>
					<h:outputText value="#{notaCreditoDatamanager.cabdevoluciones.subtotalexcentoiva}" style="display:block;width: 100px;"/>
					<p:outputLabel value="#{msg['lbl_total_descuento']}:"/>
					<h:outputText value="#{notaCreditoDatamanager.cabdevoluciones.totaldescuento}" style="display:block;width: 100px;"/>
					<p:outputLabel value="#{msg['lbl_valorice']}:" style="display:block;width: 150px;"/>
					<h:outputText value="#{notaCreditoDatamanager.cabdevoluciones.valorice}" style="display:block;width: 100px;"/>
					<p:outputLabel value="#{msg['lbl_valorirbpnr']}:"/>
					<h:outputText value="#{notaCreditoDatamanager.cabdevoluciones.valorirbpnr}" style="display:block;width: 100px;"/>
					<p:outputLabel value="#{msg['lbl_iva12']}:" style="display:block;width: 150px;"/>
					<h:outputText value="#{notaCreditoDatamanager.cabdevoluciones.iva}" style="display:block;width: 100px;"/>
					<p:outputLabel value="#{msg['lbl_total_factura']}:"/>
					<h:outputText value="#{notaCreditoDatamanager.cabdevoluciones.total}" style="display:block;width: 100px;"/>
				</h:panelGrid>
			</p:fieldset>
			<h:panelGrid columns="3">
				<p:commandButton
					icon="ui-icon-disk" 
					value="#{msg['btn_guardar_completo']}"/>
				<p:commandButton value="#{msg['btn_guardar_nofirma']}"
					icon="ui-icon-check"/>
			</h:panelGrid>
		</p:panel>
	</ui:define>
	
	<ui:define name="dialogArea">
		<p:dialog widgetVar="dlgClienteBusqueda" appendTo="@(body)" modal="true" resizable="false" closeOnEscape="true">
		<h:form id="frmClis">
			<p:panel header="#{msg.lbl_clientes}" style="width:900px !important">
				  	<p:fieldset legend="#{msg['lbl_busqueda']}">
				  		<h:panelGroup layout="block" id="pnlBusquedacliente">
				  			<h:panelGrid columns="3">
				  				<p:outputLabel value="#{msg['lbl_nombre']}:" for="txtNombre"/>
				  				<p:inputText id="txtNombre" value="#{clienteDatamanager.clienteserch.tsyspersona.nombres}"/>
				  				<p:message for="txtNombre" display="icon"/>
				  				<p:outputLabel value="#{msg['lbl_apellidos']}:" for="txtApellidos"/>
				  				<p:inputText id="txtApellidos" value="#{clienteDatamanager.clienteserch.tsyspersona.apellidos}"/>
				  				<p:message for="txtApellidos" display="icon"/>
				  				<p:outputLabel value="#{msg['lbl_tipo_id']}:" for="selTipoIdentificacion"/>
				  				<p:selectOneMenu id="selTipoIdentificacion" value="#{clienteDatamanager.clienteserch.tsyspersona.tipoid}">
				  					<f:selectItem itemLabel="Seleccione" itemValue="#{null}"/>
				  					<f:selectItems value="#{clienteDatamanager.tiposCatalogo}" var="item" itemLabel="#{item.descripcion}" itemValue="#{item.pk.codigocatalogo}"/>
				  				</p:selectOneMenu>
				  				<p:message for="selTipoIdentificacion" display="icon"/>
				  				<p:outputLabel value="#{msg['lbl_identificacion']}:" for="txtIdentificacion"/>
				  				<p:inputText id="txtIdentificacion" value="#{clienteDatamanager.clienteserch.tsyspersona.identificacion}"/>
				  				<p:message for="txtIdentificacion" display="icon"/>
				  			</h:panelGrid>
				  		</h:panelGroup>
				  		<h:panelGroup layout="block" style="float:left">
				  			<p:commandButton icon="ui-icon-search" value="#{msg['btn_buscar']}" action="#{clienteController.buscar()}" update="pnlDataArticulos" process="@this :frmClis:pnlBusquedacliente"/>
				  			<p:commandButton icon="ui-icon-plusthick" value="#{msg['btn_crear']}" oncomplete="PF('dlgCliente').show()" 
				  				action="#{clienteController.crearArticulo()}" update=":frmCreacionArticulos:pnlArticulo"/>
				  		</h:panelGroup>
				  	</p:fieldset>
				  	<p:fieldset legend="#{msg['lbl_listado_clientes']}">
				  		<h:panelGroup layout="block" id="pnlDataArticulos">
				  			<p:dataTable value="#{clienteDatamanager.clientesCol}" var="item" id="tblaDatos">
				  				<p:column headerText="#{msg['lbl_codigo_principal']}">
				  					<h:outputText value="#{item.pk.codigocliente}" />
				  				</p:column>
				  				<p:column headerText="#{msg['lbl_nombre']}">
				  					<h:outputText value="#{item.tsyspersona.nombres}" />
				  				</p:column>
				  				<p:column headerText="#{msg['lbl_apellidos']}">
				  					<h:outputText value="#{item.tsyspersona.apellidos}" />
				  				</p:column>
				  				<p:column headerText="#{msg['lbl_tipo_id']}">
				  					<h:outputText value="#{item.tsyspersona.tadmtipopersona.descripcion}" />
				  				</p:column>
				  				<p:column headerText="#{msg['lbl_identificacion']}">
				  					<h:outputText value="#{item.tsyspersona.identificacion}" />
				  				</p:column>
				  				<p:column headerText="#{msg['lbl_estado']}">
				  					<h:outputText value="#{item.tsyspersona.tadmestado.descripcion}" />
				  				</p:column>
				  				<p:column styleClass="bun-action" style="text-align:center">
				  					<p:commandButton icon="ui-icon-pencil" title="#{msg['btn_actualizar']}" oncomplete="PF('dlgCliente').show();" update=":frmCreacionArticulos:pnlArticulo" process="@this" immediate="true">
				  						<f:setPropertyActionListener target="#{clienteDatamanager.clienteComponente.tfaccliente}" value="#{item}"/>
				  					</p:commandButton>
				  				</p:column>
				  				<p:column styleClass="bun-action" style="text-align:center">
				  					<p:commandButton icon="ui-icon-trash" title="#{msg['btn_eliminar']}" action="#{clienteController.eliminar(item.tsyspersona.pk.codigopersona)}" update=":frmClis:pnlDataArticulos" process="@this"/>
				  				</p:column>
				  				<p:column styleClass="bun-action" style="text-align:center">
				  					<p:commandButton icon="ui-icon-circle-check" title="#{msg['btn_seleccionar']}" oncomplete="PF('dlgClienteBusqueda').hide();" update=":frmNotaCredito:pnlCliente" process="@this" immediate="true">
				  						<f:setPropertyActionListener target="#{notaCreditoDatamanager.cabdevoluciones.tfaccliente}" value="#{item}"/>
				  					</p:commandButton>
				  				</p:column>
				  			</p:dataTable>
				  		</h:panelGroup>
				  	</p:fieldset>
		  </p:panel>
		</h:form>	
		</p:dialog>
	  	<p:dialog widgetVar="dlgCliente" appendTo="@(body)" modal="true" resizable="false" closeOnEscape="true">
	  		<f:facet name="header">
	  			<h:outputText value="#{msg['lbl_clientes']}" />
	  		</f:facet>
			<h:form id="frmCreacionArticulos">
				<b:clienteComponent id="pnlArticulo" controller="#{clienteDatamanager.clienteComponente}" processSave="@this" updateSave=":frmClis:pnlDataArticulos" oncompleteSave="PF('dlgCliente').hide();" oncompleteCancel="PF('dlgCliente').hide();"/>
			</h:form>	  		
	  	</p:dialog>
		<p:dialog widgetVar="dialogFactura">
			<f:facet name="header">
				<h:outputText value="#{msg.lbl_factura}" />
			</f:facet>
			
			<h:form id="frmBusquedaCliente">
				<h:panelGroup id="pnlBusqCliente" appendTo="@(body)" modal="true" resizable="false" closeOnEscape="true">
					<h:panelGrid columns="3">
						<p:outputLabel for="txtNumFactura" value="#{msg.lbl_num_fac}:"/>
						<p:inputText id="txtNumFactura"/>
						<p:message for="txtNumFactura"/>
					</h:panelGrid>
				</h:panelGroup>
			</h:form>
		</p:dialog>
	</ui:define>
</ui:composition>
